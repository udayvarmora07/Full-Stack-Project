name: ci-cd-pipeline
on: 
    push:
        branches: 
            - main
env:
    DOCKER_USERNAME: uday0710
jobs:
    frontend-docker-build:
        runs-on: ubuntu-latest
        steps:
          - name: checkout
            uses: actions/checkout@v4
          - name: log in to docker hub
            uses: docker/login-action@v3
            with:
              username: ${{ env.DOCKER_USERNAME }}
              password: ${{ secrets.DOCKER_PASSWORD }}
          - name: set up docker buildx
            uses: docker/setup-buildx-action@v3
          - name: build and push docker image
            uses: docker/build-push-action@v6
            with:
              file: ./frontend/Dockerfile
              context: ./frontend
              push: true
              tags: ${{env.DOCKER_USERNAME}}/backend-node:latest
    
    frontend-kubernetes-deploy:
        runs-on: ubuntu-latest
        needs: frontend-docker-build
        steps:
          - name: checkout
            uses: actions/checkout@v4
          - name: Install Helm
            uses: azure/setup-helm@v4
          - name: configure kubeconfig
            uses: azure/k8s-set-context@v4
            with:
              method: kubeconfig
              kubeconfig: ${{secrets.KUBE_CONFIG}}
          - name: deploy helm chart
            run: |
              helm upgrade \
              --install \
              frontend-release \
              ./kubernetes/frontend \

